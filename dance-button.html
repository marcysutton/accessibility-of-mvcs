<!DOCTYPE html>
<html>
<head>
  <title>x-gif demo</title>
  <script>
    if ('registerElement' in document
      && 'createShadowRoot' in HTMLElement.prototype
      && 'import' in document.createElement('link')
      && 'content' in document.createElement('template')) {
      // We're using a browser with native WC support!
    } else {
      document.write('<script src="https:\/\/cdnjs.cloudflare.com/ajax/libs/polymer/0.3.4/platform.js"><\/script>')
    }
  </script>
  <script src="demos/shared/js/lib/angular.min.js"></script>
  <link rel="import" href="demos/x-gif/x-gif.html">
  <style>
    audio {
      position: relative;
      z-index: 1;
    }
    x-gif {
      bottom: 0;
      left: 0;
      position: absolute;
      right: 0;
      top: 0;
    }
    x-gif #frames {
      height: 100%;
      width: 100%;
    }
    x-gif img {
      height: 100vh;
      width: 100vw;
    }
  </style>
</head>
<body ng-app="x-gif-demo" ng-controller="DemoCtrl">
<div ng-show="gif.metadata">
  <audio controls preload>
    <source src="demos/x-gif/get_down_on_it.ogg" type="audio/ogg">
    <source src="demos/x-gif/get_down_on_it.mp3" type="audio/mpeg">
  </audio>
</div>
<div ng-hide="gif.metadata">Loading beat data...</div>
<x-gif class="x-gif-synced-demo" ng-src="{{ trustedUrl() }}" sync></x-gif>
<script src="demos/x-gif/synched_playback.js"></script>
<script charset="utf-8">
  angular.module('x-gif-demo', [])
    .controller('DemoCtrl', function ($scope, $sce, $location, $http) {
      $scope.gifs = [
        "http://i.imgur.com/KhQ4THw.gif"
      ];
      $scope.gif = {
        url: $scope.gifs[0],
        speed: 2,
        bpm: 60,
        playbackRate: 1,
        nTimes: 1.0
      };
      var audio = document.querySelector('audio');
      $http.get('demos/x-gif/cc_audio/encom_part_ii.json').then(function (response) {
        $scope.gif.metadata = response.data;
        setupAudioSynching(audio,
          document.querySelectorAll('.x-gif-synced-demo'),
          $scope.gif.metadata)
      })
      $scope.trustedUrl = function () {
        return $sce.trustAsResourceUrl($scope.gif.url);
      }
      $scope.loc = $location;
      $scope.$watch('loc.path()', function (e) {
        if (e) $scope.gif.url = e.slice(1);
      })
      $scope.$watch('gif.url', function (e) {
        if (e) $scope.loc.path(e);
      })
    });
</script>
</body>
</html>
